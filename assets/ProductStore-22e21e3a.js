import{u as n,x as c}from"./index-4827bd10.js";import{a as d,u as h}from"./ToastMessageStore-265c6617.js";import{u as g}from"./CartStore-c5ee67d9.js";const{VITE_API:o,VITE_API_PATH:a}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"benson-vue3",BASE_URL:"/forest-sea-patisserie/",MODE:"production",DEV:!1,PROD:!0},{loadingState:i}=d(),{getCarts:p}=g(),{pushMessage:r}=h(),v=n("productStore",{state:()=>({isShow:!1,products:[],productsAll:[],product:{},pagination:{},currentPage:1,categories:[],category:"",loadingItem:"",searchTerm:"",favorites:[]}),actions:{getProducts(t=1){this.currentPage=t;let s=`${o}/api/${a}/products?page=${t}`;this.category&&(s=`${o}/api/${a}/products?page=${t}&category=${this.category}`),i(!0),c.get(s).then(e=>{this.products=e.data.products,this.pagination=e.data.pagination,i(!1),window.scrollTo(0,0)}).catch(e=>{i(!1),r({style:"danger",title:"取得產品失敗",content:`${e.response.data.message}`})})},getProductsAll(){const t=`${o}/api/${a}/products/all`;c.get(t).then(s=>{this.productsAll=s.data.products,this.categories=Array.from(new Set(this.productsAll.map(e=>e.category)))}).catch(s=>{r({style:"danger",title:"取得產品失敗，請稍後再試",content:`${s.response.data.message}`})})},setCategory(t=""){this.category=t},setQuery(t){this.searchTerm=t},addToCart(t,s=1){const e=`${o}/api/${a}/cart`,l={product_id:t,qty:s};this.loadingItem=t,c.post(e,{data:l}).then(()=>{p(),this.loadingItem="",r({title:"已加入購物車"})}).catch(u=>{this.loadingItem="",r({style:"danger",title:"加入購物車失敗，請稍後再試",content:`${u.response.data.message}`})})},getProduct(t){const s=`${o}/api/${a}/product/${t}`;i(!0),this.product={},c.get(s).then(e=>{this.product=e.data.product,this.category=e.data.product.category,i(!1)})},setFavorite(t){if(this.favorites.includes(t)){const e=this.favorites.findIndex(l=>l===t);this.favorites.splice(e,1),r({title:"已刪除產品"})}else this.favorites.push(t),r({title:"已加入我的最愛"});const s=JSON.stringify(this.favorites);localStorage.setItem("favorites",""),localStorage.setItem("favorites",s),this.getFavorites()},getFavorites(){this.favorites=JSON.parse(localStorage.getItem("favorites"))||[]}},getters:{filterProductsList(){return this.searchTerm===""?this.productsAll:this.productsAll.filter(t=>t.title.includes(this.searchTerm)||t.category.includes(this.searchTerm))},filterHotProducts(){return this.productsAll.filter(t=>t.is_hot===1)},filterCategoryProducts(){return this.productsAll.filter(t=>t.category===this.category)},filterFavorites(){return this.productsAll.filter(t=>this.favorites.includes(t.id))}}});export{v as u};
