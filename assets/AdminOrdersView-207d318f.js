import{M as w}from"./modal-6655f329.js";import{_ as f,o as n,c as a,a as t,t as d,d as P,F as b,j as g,e as D,P as C,g as M,m as T,i as _,b as m,r as p,n as V}from"./index-c79f23f6.js";import{T as E}from"./ThePagination-fa2660d7.js";import{a as I,u as U}from"./ToastMessageStore-851a6cf0.js";import{u as v}from"./OrderStore-8200886c.js";import"./base-component-c20de0b7.js";const j={props:{order:{type:Object,default(){return{}}}},emits:["updateOrder"],data(){return{modal:{},tempOrder:{products:{},user:{}}}},watch:{order(){this.tempOrder=this.order}},methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()},createDate(l){const e=new Date(l*1e3),r=e.getFullYear(),u=e.getMonth()+1>=10?e.getMonth()+1:`0${e.getMonth()+1}`,o=e.getDate()>=10?e.getDate():`0${e.getDate()}`;return`${r}/${u}/${o}`}},mounted(){this.modal=new w(this.$refs.modal)}},N={class:"modal fade",ref:"modal",tabindex:"-1"},B={class:"modal-dialog modal-xl"},F={class:"modal-content"},L={class:"modal-header bg-dark text-light"},G={class:"fs-5"},H=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),R={class:"modal-body"},q={class:"container-fluid"},z={class:"row"},Y={class:"col-md-5"},J=t("h3",{class:"mb-3"},"訂購人資料",-1),K={class:"table"},Q={key:0},W=t("th",{style:{width:"100px"}},"姓名",-1),X=t("th",null,"Email",-1),Z=t("th",null,"電話",-1),tt=t("th",null,"地址",-1),et={class:"col-md-7"},st=t("h3",{class:"mb-3"},"訂單明細",-1),ot={class:"table"},dt=t("th",{style:{width:"100px"}},"訂單編號",-1),lt=t("th",null,"下單時間",-1),nt=t("th",null,"付款狀態",-1),at={key:0,class:"text-success"},it={key:1,class:"text-muted"},rt=t("th",null,"總金額",-1),ct=t("h4",null,"訂購商品",-1),ht={class:"table"},ut=t("thead",null,[t("tr",null,[t("th",{width:"15%"}),t("th",{width:"35%"}),t("th",{width:"20%"}),t("th",{width:"15%"}),t("th",{width:"15%"})])],-1),_t={class:"text-center"},mt=["src"],pt={class:"fs-5"},bt={class:"text-end"},gt={class:"d-flex justify-content-end"},ft={class:"form-check"},Ot={class:"form-check-label",for:"flexCheckDefault"},$t={key:0},yt={key:1},Mt={class:"modal-footer"},vt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function kt(l,e,r,u,o,c){return n(),a("div",N,[t("div",B,[t("div",F,[t("div",L,[t("h2",G,"訂單編號 : "+d(o.tempOrder.id),1),H]),t("div",R,[t("div",q,[t("div",z,[t("div",Y,[J,t("table",K,[o.tempOrder.user?(n(),a("tbody",Q,[t("tr",null,[W,t("td",null,d(o.tempOrder.user.name),1)]),t("tr",null,[X,t("td",null,d(o.tempOrder.user.email),1)]),t("tr",null,[Z,t("td",null,d(o.tempOrder.user.tel),1)]),t("tr",null,[tt,t("td",null,d(o.tempOrder.user.address),1)])])):P("",!0)])]),t("div",et,[st,t("table",ot,[t("tbody",null,[t("tr",null,[dt,t("td",null,d(o.tempOrder.id),1)]),t("tr",null,[lt,t("td",null,d(c.createDate(o.tempOrder.create_at)),1)]),t("tr",null,[nt,t("td",null,[o.tempOrder.is_paid?(n(),a("strong",at,"已付款")):(n(),a("span",it,"尚未付款"))])]),t("tr",null,[rt,t("td",null,d(o.tempOrder.total),1)])])]),ct,t("table",ht,[ut,t("tbody",null,[(n(!0),a(b,null,g(o.tempOrder.products,i=>(n(),a("tr",{key:i.id,class:"align-middle"},[t("td",_t,[t("img",{src:i.product.imageUrl,class:"object-cover",style:{height:"100px",width:"100px"}},null,8,mt)]),t("td",pt,d(i.product.title),1),t("td",null,"NT$ "+d(i.product.price),1),t("td",null,d(i.qty)+" "+d(i.product.unit),1),t("td",bt,"$ "+d(i.final_total),1)]))),128))])]),t("div",gt,[t("div",ft,[D(t("input",{class:"form-check-input",type:"checkbox",id:"flexCheckDefault","onUpdate:modelValue":e[0]||(e[0]=i=>o.tempOrder.is_paid=i)},null,512),[[C,o.tempOrder.is_paid]]),t("label",Ot,[o.tempOrder.is_paid?(n(),a("span",$t,"已付款")):(n(),a("span",yt,"未付款"))])])])])])])]),t("div",Mt,[vt,t("button",{type:"button",class:"btn btn-danger",onClick:e[1]||(e[1]=i=>l.$emit("updateOrder",o.tempOrder))}," 修改訂單 ")])])])],512)}const xt=f(j,[["render",kt]]),wt={props:{tempOrder:{type:Object}},data(){return{modal:{}}},methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()},deleteOrder(l){this.$emit("deleteOrder",l),this.closeModal()}},mounted(){this.modal=new w(this.$refs.modal)}},Dt={class:"modal",ref:"modal",tabindex:"-1"},Ct={class:"modal-dialog"},At={class:"modal-content"},St=t("div",{class:"modal-header bg-danger text-white"},[t("h2",null,"刪除訂單"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Pt={class:"modal-body"},Tt={class:"text-danger"},Vt={class:"modal-footer"},Et=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function It(l,e,r,u,o,c){return n(),a("div",Dt,[t("div",Ct,[t("div",At,[St,t("div",Pt,[M(" 是否刪除 "),t("strong",Tt,d(r.tempOrder.id),1),M(" 訂單(刪除後將無法恢復)。 ")]),t("div",Vt,[Et,t("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=i=>c.deleteOrder(r.tempOrder.id))}," 確認刪除 ")])])])],512)}const Ut=f(wt,[["render",It]]),{VITE_API:k,VITE_API_PATH:x}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"benson-vue3",BASE_URL:"/forest-sea-patisserie/",MODE:"production",DEV:!1,PROD:!0},jt={components:{AdminOrderModal:xt,AdminOrderDeleteModal:Ut,ThePagination:E},data(){return{tempOrder:{}}},computed:{...T(v,["orders","pagination"])},methods:{..._(v,["getOrders","createDate"]),..._(I,["loadingState"]),..._(U,["pushMessage"]),openModal(l,e){l==="edit"?(this.tempOrder={...e},this.$refs.orderModal.openModal()):(this.tempOrder={...e},this.$refs.deleteOrderModal.openModal())},updateOrder(l){const e=`${k}/api/${x}/admin/order/${l.id}`;this.loadingState(!0),this.tempOrder={...l},this.$http.put(e,{data:this.tempOrder}).then(()=>{this.getOrders(this.currentPage),this.loadingState(!1),this.$refs.orderModal.closeModal(),this.pushMessage({title:"更改訂單成功"})}).catch(r=>{this.pushMessage({style:"danger",title:"更改失敗，請稍後再試",content:`${r.response.data.message}`}),this.loadingState(!1)})},deleteOrder(l){const e=`${k}/api/${x}/admin/order/${l}`;this.loadingState(!0),this.$http.delete(e).then(()=>{this.getOrders(this.currentPage),this.loadingState(!1),this.pushMessage({title:"已刪除訂單"})}).catch(r=>{this.pushMessage({style:"danger",title:"更改失敗，請稍後再試",content:`${r.response.data.message}`}),this.loadingState(!1)})}},mounted(){this.getOrders()}},Nt={class:"container my-4"},Bt=t("h2",{class:"text-center my-3"},"訂單列表",-1),Ft={class:"table mt-4 container"},Lt=t("thead",null,[t("tr",null,[t("th",{width:"15%"},"訂單日期"),t("th",{width:"25%"},"訂購人資訊"),t("th",{width:"30%"},"訂購商品"),t("th",{width:"15%"},"訂單狀態"),t("th",{width:"15%"},"操作")])],-1),Gt={class:"d-flex flex-column"},Ht=["href"],Rt={class:"form-check form-switch"},qt=["id","onChange","onUpdate:modelValue"],zt=["for"],Yt={class:"btn-group"},Jt=["onClick"],Kt=["onClick"];function Qt(l,e,r,u,o,c){const i=p("ThePagination"),A=p("AdminOrderModal"),S=p("AdminOrderDeleteModal");return n(),a("div",Nt,[Bt,t("table",Ft,[Lt,t("tbody",null,[(n(!0),a(b,null,g(l.orders,s=>{var O,$,y;return n(),a("tr",{key:s.id,class:"align-middle"},[t("td",null,d(l.createDate(s.create_at)),1),t("td",null,[t("div",Gt,[t("span",null,d((O=s==null?void 0:s.user)==null?void 0:O.name),1),t("a",{href:`mailto:${($=s==null?void 0:s.user)==null?void 0:$.email}`,class:"d-block link-dark"},d((y=s==null?void 0:s.user)==null?void 0:y.email),9,Ht)])]),t("td",null,[t("ul",null,[(n(!0),a(b,null,g(s.products,h=>(n(),a("li",{key:h.id},d(h.product.title),1))),128))])]),t("td",null,[t("div",Rt,[D(t("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${s.id}`,onChange:h=>c.updateOrder(s),"onUpdate:modelValue":h=>s.is_paid=h},null,40,qt),[[C,s.is_paid]]),t("label",{class:V(["form-check-label",{"text-success":s.is_paid,"text-danger":!s.is_paid}]),for:`paidSwitch${s.id}`},d(s.is_paid?"已付款":"未付款"),11,zt)])]),t("td",null,[t("div",Yt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:h=>c.openModal("edit",s)}," 編輯 ",8,Jt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:h=>c.openModal("delete",s)}," 刪除 ",8,Kt)])])])}),128))])]),m(i,{pages:l.pagination,onGetData:l.getOrders},null,8,["pages","onGetData"]),m(A,{onUpdateOrder:c.updateOrder,ref:"orderModal",order:o.tempOrder},null,8,["onUpdateOrder","order"]),m(S,{ref:"deleteOrderModal","temp-order":o.tempOrder,onDeleteOrder:c.deleteOrder},null,8,["temp-order","onDeleteOrder"])])}const oe=f(jt,[["render",Qt]]);export{oe as default};
